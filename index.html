<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Haftalık Ziyaret Raporu</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
.container{max-width:900px;margin:auto;padding:12px}
.card{background:#fff;padding:10px;margin-bottom:10px;border-radius:8px}
button{padding:10px;margin:5px}
</style>
</head>

<body>
<div class="container">

<h2>Haftalık Ziyaret Raporu</h2>

<input id="personel" placeholder="Personel"><br>
<input id="bolge" placeholder="Bölge"><br>

<div id="visits"></div>

<button onclick="saveData()">Kaydet</button>
<button onclick="loadData()">Yükle</button>
<button onclick="exportPDF()">PDF</button>
<button onclick="exportExcel()">Excel</button>

</div>

<script>
const KEY='haftalik_test';

/* ZİYARETLERİ OLUŞTUR */
const visitsDiv=document.getElementById('visits');
for(let i=1;i<=5;i++){
 visitsDiv.innerHTML+=`
 <div class="card">
  <b>${i}. Ziyaret</b><br>
  <input placeholder="Firma" data-k="v${i}_firma">
  <input placeholder="Amaç" data-k="v${i}_amac">
 </div>`;
}

/* KAYDET */
function saveData(){
 const data={
  personel:personel.value,
  bolge:bolge.value,
  visits:{}
 };
 document.querySelectorAll('[data-k]').forEach(e=>{
  data.visits[e.dataset.k]=e.value;
 });
 localStorage.setItem(KEY,JSON.stringify(data));
 alert('Kaydedildi');
}

/* YÜKLE */
function loadData(){
 const data=JSON.parse(localStorage.getItem(KEY));
 if(!data){alert('Kayıt yok');return;}
 personel.value=data.personel||'';
 bolge.value=data.bolge||'';
 document.querySelectorAll('[data-k]').forEach(e=>{
  e.value=data.visits[e.dataset.k]||'';
 });
}

/* PDF */
function exportPDF(){
 const data=JSON.parse(localStorage.getItem(KEY));
 if(!data){alert('Önce kaydet');return;}

 const div=document.createElement('div');
 div.innerHTML=`<h1>Haftalık Rapor</h1><p>${data.personel} - ${data.bolge}</p>`;

 Object.keys(data.visits).forEach(k=>{
  if(data.visits[k])
   div.innerHTML+=`<p>${data.visits[k]}</p>`;
 });

 html2pdf().from(div).save('rapor.pdf');
}

/* EXCEL */
function exportExcel(){
 const data=JSON.parse(localStorage.getItem(KEY));
 if(!data){alert('Önce kaydet');return;}

 const rows=[['Alan','Değer']];
 rows.push(['Personel',data.personel]);
 rows.push(['Bölge',data.bolge]);

 Object.keys(data.visits).forEach(k=>{
  rows.push([k,data.visits[k]]);
 });

 const wb=XLSX.utils.book_new();
 const ws=XLSX.utils.aoa_to_sheet(rows);
 XLSX.utils.book_append_sheet(wb,ws,'Rapor');
 XLSX.writeFile(wb,'rapor.xlsx');
}
</script>
</body>
</html>
