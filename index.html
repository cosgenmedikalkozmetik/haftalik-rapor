<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Haftalık Ziyaret Raporu</title>

<!-- PDF KÜTÜPHANESİ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root{--primary:#0b2a55;--accent:#1e88e5;--border:#e0e0e0;--bg:#f4f6f8}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bg)}
.header{background:var(--primary);color:#fff;padding:16px;text-align:center}
.container{max-width:900px;margin:auto;padding:12px}
.info{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
@media(max-width:768px){.info{grid-template-columns:1fr}}
.tabs{display:flex;gap:6px;margin-bottom:12px}
.tab{flex:1;padding:10px;border:none;background:#ddd;font-weight:bold;border-radius:8px}
.tab.active{background:var(--accent);color:#fff}
.card{background:#fff;border-radius:12px;padding:10px;margin-bottom:10px;border-left:5px solid var(--accent)}
.day h3{margin:0 0 8px 0;background:#e3f2fd;padding:6px;border-radius:8px}
label{font-weight:bold;font-size:13px;display:block;margin-top:6px}
input,select{width:100%;padding:8px;border-radius:6px;border:1px solid var(--border)}
.actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:16px}
button{padding:14px;border:none;border-radius:12px;font-size:15px;color:#fff}
.save{background:#43a047}
.pdf{background:#e53935}
</style>
</head>
<body>

<div class="header">HAFTALIK ZİYARET RAPORU</div>

<div class="container" id="report">
<div class="info">
<select id="personelSelect"></select>
<input id="bolge" placeholder="Bölge / Şehir">
<input id="tarih" placeholder="Tarih Aralığı">
<input id="plaka" placeholder="Araç Plaka">
<input id="kmBaslangic" type="number" placeholder="Başlangıç KM">
<input id="kmBitis" type="number" placeholder="Bitiş KM">
</div>

<div class="tabs">
<button class="tab active" onclick="openDay(0)">PZT</button>
<button class="tab" onclick="openDay(1)">SAL</button>
<button class="tab" onclick="openDay(2)">ÇRŞ</button>
<button class="tab" onclick="openDay(3)">PRŞ</button>
<button class="tab" onclick="openDay(4)">CUMA</button>
</div>

<div id="days"></div>

<div class="card" style="background:#e3f2fd;border-left:6px solid #0b2a55">
 <h2 style="margin:0 0 8px 0;text-align:center">HAFTALIK YÖNETİCİ ÖZETİ</h2>
 <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center;font-size:16px">
  <div><b>Toplam Ziyaret</b><br><span id="haftaZiyaret">0</span></div>
  <div><b>Toplam Numune</b><br><span id="haftaNumune">0</span></div>
  <div><b>Toplam Katalog</b><br><span id="haftaKatalog">0</span></div>
  <div><b>Toplam KM</b><br><span id="haftaKM">0</span></div>
 </div>
</div>

<div class="actions">
<button class="save" onclick="saveData()">Kaydet</button>
<button class="pdf" onclick="exportPDF()">PDF</button>
</div>
</div>

<script>
/************** TEMEL **************/
const STORAGE_KEY='haftalikRapor_v2';

const personeller=['Hasret Gökot','Ömür Kaplan','Gamze Kaç','Işıl Engin'];
const personelSelect=document.getElementById('personelSelect');
personelSelect.innerHTML=personeller.map(p=>`<option>${p}</option>`).join('');

/************** GÜNLER **************/
const gunAdlari=['Pazartesi','Salı','Çarşamba','Perşembe','Cuma'];
const visitCount=15;
const daysDiv=document.getElementById('days');

for(let d=0;d<5;d++){
 let html=`<div class="day" style="display:${d===0?'block':'none'}"><h3>${gunAdlari[d]}</h3>`;
 for(let i=1;i<=visitCount;i++){
  html+=`<div class="card">
   <b>${i}. Ziyaret</b>
   <input type="time" data-k="d${d}v${i}_time">
   <input placeholder="Firma / Cari" data-k="d${d}v${i}_firma">
   <select data-k="d${d}v${i}_amac">
    <option value="">Amaç</option>
    <option>Tanışma</option>
    <option>Tekrar Ziyaret</option>
    <option>İade</option>
    <option>Ürün Tanıtımı</option>
   </select>
   <label><input type="checkbox" data-k="d${d}v${i}_numune"> Numune</label>
   <label><input type="checkbox" data-k="d${d}v${i}_katalog"> Katalog</label>
  </div>`;
 }
 html+='</div>';
 daysDiv.innerHTML+=html;
}

function openDay(i){
 document.querySelectorAll('.tab').forEach((t,idx)=>t.classList.toggle('active',idx===i));
 document.querySelectorAll('.day').forEach((d,idx)=>d.style.display=idx===i?'block':'none');
}

/************** KAYDET **************/
function saveData(){
 const data={meta:{personel:personelSelect.value,bolge:bolge.value,tarih:tarih.value,plaka:plaka.value,kmBas:kmBaslangic.value,kmBit:kmBitis.value},v:{}};
 document.querySelectorAll('[data-k]').forEach(e=>{data.v[e.dataset.k]=e.type==='checkbox'?e.checked:e.value});
 localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
 alert('Kaydedildi');
}

/************** PDF – SADECE DOLU GÜNLER **************/
function exportPDF(){
 const data=JSON.parse(localStorage.getItem(STORAGE_KEY));
 if(!data){alert('Kayıt yok');return;}

 let html=`<h1>HAFTALIK YÖNETİCİ RAPORU</h1>
 <p><b>Personel:</b> ${data.meta.personel} | <b>Bölge:</b> ${data.meta.bolge}</p>`;

 let z=0,n=0,k=0;
 Object.keys(data.v).forEach(x=>{
  if(x.endsWith('firma') && data.v[x]) z++;
  if(x.endsWith('numune') && data.v[x]) n++;
  if(x.endsWith('katalog') && data.v[x]) k++;
 });
 const km=(Number(data.meta.kmBit)-Number(data.meta.kmBas))||0;

 html+=`<table border="1" width="100%" cellpadding="6"><tr><th>Ziyaret</th><th>Numune</th><th>Katalog</th><th>KM</th></tr>
 <tr><td>${z}</td><td>${n}</td><td>${k}</td><td>${km}</td></tr></table><br>`;

 gunAdlari.forEach((g,di)=>{
  let rows='';
  for(let i=1;i<=visitCount;i++){
   const f=data.v[`d${di}v${i}_firma`];
   if(!f) continue;
   rows+=`<tr><td>${data.v[`d${di}v${i}_time`]||''}</td><td>${f}</td><td>${data.v[`d${di}v${i}_amac`]||''}</td><td>${data.v[`d${di}v${i}_numune`]?'✔':''}</td><td>${data.v[`d${di}v${i}_katalog`]?'✔':''}</td></tr>`;
  }
  if(rows){
   html+=`<h3>${g}</h3><table border="1" width="100%" cellpadding="6"><tr><th>Saat</th><th>Firma</th><th>Amaç</th><th>Numune</th><th>Katalog</th></tr>${rows}</table><br>`;
  }
 });

 const w=document.createElement('div');
 w.innerHTML=html;
 html2pdf().from(w).set({filename:'yonetici_raporu.pdf',html2canvas:{scale:2}}).save();
}
</script>
</body>
</html>
